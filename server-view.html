<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>schwarm D.I. â€“ DISCO INTELLIGENCE. | Server View</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="public/css/server-view.css">
</head>

<body>
    <div id="api-key-modal">
        <div class="modal-content">
            <h2>ðŸŽµ Lyria Music Generation</h2>
            <p>Enter your Google Gemini API key to enable realtime music generation based on player positions.</p>
            <input type="password" id="api-key-input" placeholder="Enter your Gemini API key">
            <button onclick="connectLyria()">Connect & Start Music</button>
            <p>The music will adapt in realtime based on where players are positioned in the genre sections.</p>
        </div>
    </div>

    <div id="ui-bar">
        <div class="left">
            <div class="title">schwarm D.I. â€“ DISCO INTELLIGENCE.</div>
            <div class="info">PLAYERS: <span id="player-count">0</span></div>
            <div id="music-status">ðŸŽµ Music: Not Connected</div>
        </div>
        <div class="right">
            <div id="playback-controls">
                <button id="connect-btn" title="Connect to Lyria">Connect</button>
                <button id="refresh-prompt-btn" disabled title="Refresh Prompt">
                    <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2" fill="none"
                        stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="23 4 23 10 17 10"></polyline>
                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                    </svg>
                </button>
                <button id="play-btn" disabled title="Play">â–¶</button>
                <button id="stop-btn" disabled title="Stop">â– </button>
                <div id="volume-control">
                    <span style="font-size: 12px;">ðŸ”Š</span>
                    <input type="range" id="volume-slider" min="0" max="100" value="100" />
                    <span id="volume-label">100%</span>
                </div>
            </div>
            <div id="connection-status" class="status disconnected">CONNECTING</div>
        </div>
    </div>

    <div id="stats-sidebar">
        <div class="chart-container">
            <div class="chart-title">GENRE DISTRIBUTION (LIVE)</div>
            <div class="genre-bars">
                <!-- Bars generated by JS or static for now -->
                <div class="genre-bar">
                    <div class="genre-name" id="stat-name-0">Genre 1</div>
                    <div class="bar-container">
                        <div class="bar-fill" id="stat-bar-0" style="width: 0%"><span class="bar-percentage"
                                id="stat-pct-0">0%</span></div>
                    </div>
                </div>
                <div class="genre-bar">
                    <div class="genre-name" id="stat-name-1">Genre 2</div>
                    <div class="bar-container">
                        <div class="bar-fill" id="stat-bar-1" style="width: 0%"><span class="bar-percentage"
                                id="stat-pct-1">0%</span></div>
                    </div>
                </div>
                <div class="genre-bar">
                    <div class="genre-name" id="stat-name-2">Genre 3</div>
                    <div class="bar-container">
                        <div class="bar-fill" id="stat-bar-2" style="width: 0%"><span class="bar-percentage"
                                id="stat-pct-2">0%</span></div>
                    </div>
                </div>
                <div class="genre-bar">
                    <div class="genre-name" id="stat-name-3">Genre 4</div>
                    <div class="bar-container">
                        <div class="bar-fill" id="stat-bar-3" style="width: 0%"><span class="bar-percentage"
                                id="stat-pct-3">0%</span></div>
                    </div>
                </div>
                <div class="genre-bar">
                    <div class="genre-name" id="stat-name-4">Genre 5</div>
                    <div class="bar-container">
                        <div class="bar-fill" id="stat-bar-4" style="width: 0%"><span class="bar-percentage"
                                id="stat-pct-4">0%</span></div>
                    </div>
                </div>
                <div class="genre-bar">
                    <div class="genre-name" id="stat-name-5">Genre 6</div>
                    <div class="bar-container">
                        <div class="bar-fill" id="stat-bar-5" style="width: 0%"><span class="bar-percentage"
                                id="stat-pct-5">0%</span></div>
                    </div>
                </div>
                <div class="genre-bar">
                    <div class="genre-name" id="stat-name-6">Genre 7</div>
                    <div class="bar-container">
                        <div class="bar-fill" id="stat-bar-6" style="width: 0%"><span class="bar-percentage"
                                id="stat-pct-6">0%</span></div>
                    </div>
                </div>
                <div class="genre-bar">
                    <div class="genre-name" id="stat-name-7">Genre 8</div>
                    <div class="bar-container">
                        <div class="bar-fill" id="stat-bar-7" style="width: 0%"><span class="bar-percentage"
                                id="stat-pct-7">0%</span></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-title">GENRE HISTORY</div>
            <div class="chart-wrapper">
                <canvas id="history-chart"></canvas>
            </div>
        </div>
    </div>

    <div id="prompt-ticker">
        <div class="ticker-wrapper">
            <span class="label">CURRENT PROMPT:</span>
            <span class="text" id="prompt-text">Waiting for music generation...</span>
            <span style="margin: 0 30px;">â€¢</span>
            <span class="label">CURRENT PROMPT:</span>
            <span class="text" id="prompt-text-repeat">Waiting for music generation...</span>
            <span style="margin: 0 30px;">â€¢</span>
            <span class="label">CURRENT PROMPT:</span>
            <span class="text" id="prompt-text-repeat2">Waiting for music generation...</span>
        </div>
    </div>

    <div id="hamburger">
        <span></span>
        <span></span>
        <span></span>
    </div>

    <div id="menu">
        <h3>SINGLE PLAYER</h3>
        <div class="control-group">
            <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                <button id="add-bot-btn"
                    style="flex: 1; padding: 10px; background: #ffffff; color: #000000; border: none; border-radius: 3px; cursor: pointer; font-family: 'Roboto Mono', monospace; font-size: 11px; font-weight: bold;">+
                    ADD BUBBLE</button>
                <button id="remove-bot-btn"
                    style="flex: 1; padding: 10px; background: rgba(255, 255, 255, 0.1); color: #ffffff; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer; font-family: 'Roboto Mono', monospace; font-size: 11px; font-weight: bold;">-
                    REMOVE</button>
            </div>
            <button id="clear-bots-btn"
                style="width: 100%; margin-top: 5px; padding: 10px; background: rgba(255, 0, 0, 0.3); color: #ffffff; border: 1px solid rgba(255,0,0,0.5); border-radius: 3px; cursor: pointer; font-family: 'Roboto Mono', monospace; font-size: 11px; font-weight: bold;">CLEAR
                ALL BUBBLES</button>
        </div>

        <h3>SETTINGS</h3>

        <div class="control-group">
            <label>CIRCLE SCALE</label>
            <input type="range" id="circle-scale" min="20" max="100" value="60" step="5">
            <div class="value-display"><span id="circle-scale-value">60</span>px</div>
        </div>

        <div class="control-group">
            <div class="toggle-button active" id="pulse-toggle">
                <span>PULSE</span>
                <div class="status">ON</div>
            </div>
        </div>

        <div class="control-group">
            <div class="toggle-button active" id="fill-toggle">
                <span>CIRCLE FILL</span>
                <div class="status">ON</div>
            </div>
        </div>

        <div class="control-group">
            <div class="toggle-button" id="solid-fill-toggle">
                <span>SOLID FILL (NO RINGS)</span>
                <div class="status">OFF</div>
            </div>
        </div>

        <div class="control-group">
            <div class="toggle-button active" id="names-toggle">
                <span>PLAYER NAMES</span>
                <div class="status">ON</div>
            </div>
        </div>


        <h3 style="margin-top: 30px;">WEBGL EFFECTS</h3>

        <div class="control-group">
            <div class="toggle-button active" id="webgl-toggle">
                <span>METABALL EFFECT</span>
                <div class="status">ON</div>
            </div>
        </div>

        <div class="control-group">
            <label>COLOR PRESETS</label>
            <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                <button class="preset-btn" data-preset="standard"
                    style="flex: 1; padding: 8px; background: linear-gradient(90deg, #000000, #808080, #ffffff, #808080, #000000); color: #ffffff; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer; font-family: 'Roboto Mono', monospace; font-size: 10px;">STANDARD</button>
                <button class="preset-btn" data-preset="neon"
                    style="flex: 1; padding: 8px; background: linear-gradient(90deg, #ff00ff, #00ffff, #ff6600, #00ff00, #ffffff); color: #000000; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer; font-family: 'Roboto Mono', monospace; font-size: 10px;">NEON</button>
            </div>
            <div style="display: flex; gap: 5px; flex-wrap: wrap; margin-top: 5px;">
                <button class="preset-btn" data-preset="fire"
                    style="flex: 1; padding: 8px; background: linear-gradient(90deg, #000000, #ff0000, #ff6600, #ffff00, #ffffff); color: #000000; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer; font-family: 'Roboto Mono', monospace; font-size: 10px;">FIRE</button>
                <button class="preset-btn" data-preset="ocean"
                    style="flex: 1; padding: 8px; background: linear-gradient(90deg, #000033, #0066ff, #00ffff, #66ffff, #ffffff); color: #ffffff; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer; font-family: 'Roboto Mono', monospace; font-size: 10px;">OCEAN</button>
            </div>
            <div style="display: flex; gap: 5px; flex-wrap: wrap; margin-top: 5px;">
                <button class="preset-btn" data-preset="purple"
                    style="flex: 1; padding: 8px; background: linear-gradient(90deg, #000000, #4b0082, #9400d3, #ff00ff, #ffffff); color: #ffffff; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer; font-family: 'Roboto Mono', monospace; font-size: 10px;">PURPLE</button>
                <button class="preset-btn" data-preset="random"
                    style="flex: 1; padding: 8px; background: linear-gradient(90deg, #ff0000, #00ff00, #0000ff, #ffff00, #ff00ff); color: #000000; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer; font-family: 'Roboto Mono', monospace; font-size: 10px;">RANDOM</button>
            </div>
        </div>

        <div class="control-group">
            <label>COLOR 1 (Base)</label>
            <input type="color" id="color-1" value="#000000"
                style="width: 100%; height: 35px; background: #000000; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;">
        </div>

        <div class="control-group">
            <label>COLOR 2</label>
            <input type="color" id="color-2" value="#808080"
                style="width: 100%; height: 35px; background: #000000; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;">
        </div>

        <div class="control-group">
            <label>COLOR 3</label>
            <input type="color" id="color-3" value="#ffffff"
                style="width: 100%; height: 35px; background: #000000; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;">
        </div>

        <div class="control-group">
            <label>COLOR 4</label>
            <input type="color" id="color-4" value="#808080"
                style="width: 100%; height: 35px; background: #000000; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;">
        </div>

        <div class="control-group">
            <label>COLOR 5 (Highlights)</label>
            <input type="color" id="color-5" value="#000000"
                style="width: 100%; height: 35px; background: #000000; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;">
        </div>

        <h3 style="margin-top: 30px;">AUDIO VISUALIZATION</h3>

        <div class="control-group">
            <div class="toggle-button active" id="player-rings-toggle">
                <span>PLAYER RINGS</span>
                <div class="status">ON</div>
            </div>
        </div>

        <h3 style="margin-top: 30px;">GENRE CONFIGURATION</h3>

        <div class="control-group">
            <label>EDIT GENRES (Press Enter to Apply)</label>
            <input type="text" id="genre-0" class="genre-input" placeholder="Genre 1" maxlength="35">
            <input type="text" id="genre-1" class="genre-input" placeholder="Genre 2" maxlength="35">
            <input type="text" id="genre-2" class="genre-input" placeholder="Genre 3" maxlength="35">
            <input type="text" id="genre-3" class="genre-input" placeholder="Genre 4" maxlength="35">
            <input type="text" id="genre-4" class="genre-input" placeholder="Genre 5" maxlength="35">
            <input type="text" id="genre-5" class="genre-input" placeholder="Genre 6" maxlength="35">
            <input type="text" id="genre-6" class="genre-input" placeholder="Genre 7" maxlength="35">
            <input type="text" id="genre-7" class="genre-input" placeholder="Genre 8" maxlength="35">
        </div>

        <div class="control-group">
            <button id="apply-genres"
                style="width: 100%; padding: 10px; background: #ffffff; color: #000000; border: none; border-radius: 3px; cursor: pointer; font-family: 'Roboto Mono', monospace; font-size: 11px; font-weight: bold;">
                APPLY GENRES
            </button>
        </div>

        <h3 style="margin-top: 30px;">LYRIA MUSIC</h3>

        <div class="control-group">
            <div class="toggle-button active" id="adaptive-music-toggle">
                <span>ADAPTIVE MUSIC</span>
                <div class="status">ON</div>
            </div>
        </div>

        <div class="control-group">
            <label>BPM (60-200)</label>
            <input type="range" id="lyria-bpm" min="60" max="200" value="120" step="5">
            <div class="value-display"><span id="lyria-bpm-value">120</span></div>
        </div>

        <div class="control-group">
            <label>TEMPERATURE (0-3)</label>
            <input type="range" id="lyria-temperature" min="0" max="3" value="1.1" step="0.1">
            <div class="value-display"><span id="lyria-temperature-value">1.1</span></div>
        </div>

        <div class="control-group">
            <label>GUIDANCE (0-6)</label>
            <input type="range" id="lyria-guidance" min="0" max="6" value="4.0" step="0.1">
            <div class="value-display"><span id="lyria-guidance-value">4.0</span></div>
        </div>

        <div class="control-group">
            <label>DENSITY (0-1)</label>
            <input type="range" id="lyria-density" min="0" max="1" value="0.5" step="0.05">
            <div class="value-display"><span id="lyria-density-value">0.5</span></div>
        </div>

        <div class="control-group">
            <label>BRIGHTNESS (0-1)</label>
            <input type="range" id="lyria-brightness" min="0" max="1" value="0.5" step="0.05">
            <div class="value-display"><span id="lyria-brightness-value">0.5</span></div>
        </div>

        <div class="control-group">
            <label>SCALE</label>
            <select id="lyria-scale"
                style="width: 100%; padding: 8px; background: #000000; color: #ffffff; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; font-family: 'Roboto Mono', monospace; font-size: 11px;">
                <option value="SCALE_UNSPECIFIED" style="background: #000000; color: #ffffff;">Model Decides</option>
                <option value="C_MAJOR_A_MINOR" style="background: #000000; color: #ffffff;">C Major / A Minor</option>
                <option value="D_MAJOR_B_MINOR" style="background: #000000; color: #ffffff;">D Major / B Minor</option>
                <option value="E_MAJOR_D_FLAT_MINOR" style="background: #000000; color: #ffffff;">E Major / Câ™¯ Minor
                </option>
                <option value="F_MAJOR_D_MINOR" style="background: #000000; color: #ffffff;">F Major / D Minor</option>
                <option value="G_MAJOR_E_MINOR" style="background: #000000; color: #ffffff;">G Major / E Minor</option>
                <option value="A_MAJOR_G_FLAT_MINOR" style="background: #000000; color: #ffffff;">A Major / Fâ™¯ Minor
                </option>
                <option value="B_FLAT_MAJOR_G_MINOR" style="background: #000000; color: #ffffff;">Bâ™­ Major / G Minor
                </option>
            </select>
        </div>

        <div class="control-group">
            <button id="apply-lyria-config"
                style="width: 100%; padding: 10px; background: #ffffff; color: #000000; border: none; border-radius: 3px; cursor: pointer; font-family: 'Roboto Mono', monospace; font-size: 11px; font-weight: bold;">
                APPLY CONFIGURATION
            </button>
        </div>
    </div>

    <!-- Canvas elements pushed via CSS when sidebar is open -->
    <canvas id="webgl-canvas"></canvas>
    <canvas id="canvas"></canvas>

    <script src="/socket.io/socket.io.js"></script>
    <script type="module" src="public/js/server-view.js"></script>
</body>

</html>